<!DOCTYPE html>
<html lang="es" x-data="dashboard()">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Panel Financiero</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
</head>
<body class="bg-gradient-to-br from-blue-100 to-blue-300 min-h-screen p-6" x-data="{ menuOpen: false }">

  <script>
    if (localStorage.getItem('loggedIn') !== 'true') {
      window.location.href = 'login.html';
    }
  </script>

  <!-- Header con menú -->
  <header class="flex items-center justify-between bg-white shadow-lg rounded-xl p-4 mb-8">
    <div class="flex items-center space-x-3">
      <img src="img/logo.png" alt="Logo" class="w-10 h-10 rounded-full" />
      <h1 class="text-2xl font-bold text-blue-700">Finanzas de <span x-text="user"></span></h1>
    </div>

    <!-- Menú hamburguesa -->
    <div class="relative">
      <button @click="menuOpen = !menuOpen" class="text-blue-700 border border-blue-700 px-3 py-1 rounded hover:bg-blue-700 hover:text-white transition">
        ☰ Menú
      </button>
      <div x-show="menuOpen" @click.outside="menuOpen = false" class="absolute right-0 mt-2 w-48 bg-white shadow-lg rounded-lg z-10">
        <ul class="text-left text-blue-700">
          <li><a href="#" @click="vista = 'historial'; menuOpen = false" class="block px-4 py-2 hover:bg-blue-100">Ver Historial</a></li>
          <li><a href="#" @click="vista = 'opiniones'; menuOpen = false" class="block px-4 py-2 hover:bg-blue-100">Opiniones</a></li>
          <li><a href="#" @click="vista = 'dashboard'; menuOpen = false" class="block px-4 py-2 hover:bg-blue-100">Inicio</a></li>
          <li><a href="index.html" class="block px-4 py-2 hover:bg-blue-100">Volver al Login</a></li>
        </ul>
      </div>
    </div>
  </header>

  <!-- Vista principal del Dashboard -->
  <div x-show="vista === 'dashboard'" x-transition>
    <!-- Botones -->
    <div class="flex flex-wrap gap-4 mb-6">
      <button @click="mostrarIngreso = !mostrarIngreso" class="bg-green-500 text-white px-4 py-2 rounded-lg shadow hover:bg-green-600 transition">+ Ingreso</button>
      <button @click="mostrarGasto = !mostrarGasto" class="bg-red-500 text-white px-4 py-2 rounded-lg shadow hover:bg-red-600 transition">+ Gasto</button>
      <button @click="mostrarMeta = !mostrarMeta" class="bg-yellow-500 text-white px-4 py-2 rounded-lg shadow hover:bg-yellow-600 transition">Definir Meta</button>
    </div>

    <!-- Formularios -->
    <div class="grid md:grid-cols-3 gap-6 mb-6">
      <!-- Ingreso -->
      <div x-show="mostrarIngreso" class="bg-white rounded-xl shadow p-5" x-transition>
        <h2 class="text-lg font-semibold text-gray-700 mb-2">Agregar Ingreso</h2>
        <input type="number" x-model="nuevoIngreso" placeholder="Monto" class="p-3 border w-full rounded mb-3" />
        <label class="block mb-2"><input type="checkbox" x-model="ahorrarIngreso" class="mr-2">Destinar a Ahorros</label>
        <button @click="agregarIngreso()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Guardar Ingreso</button>
      </div>

      <!-- Gasto -->
      <div x-show="mostrarGasto" class="bg-white rounded-xl shadow p-5" x-transition>
        <h2 class="text-lg font-semibold text-gray-700 mb-2">Agregar Gasto</h2>
        <input type="number" x-model="nuevoGasto" placeholder="Monto" class="p-3 border w-full rounded mb-3" />
        <button @click="agregarGasto()" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Guardar Gasto</button>
      </div>

      <!-- Meta -->
      <div x-show="mostrarMeta" class="bg-white rounded-xl shadow p-5" x-transition>
        <h2 class="text-lg font-semibold text-gray-700 mb-2">Meta de Ahorro</h2>
        <input type="text" x-model="nombreMeta" placeholder="Nombre de la meta" class="p-3 border w-full rounded mb-3" />
        <input type="number" x-model="metaAhorro" placeholder="Monto objetivo" class="p-3 border w-full rounded mb-3" />
        <button class="bg-yellow-600 text-white px-4 py-2 rounded hover:bg-yellow-700">Establecer</button>
      </div>
    </div>

    <!-- Tarjetas resumen -->
    <section class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
      <div class="bg-white rounded-xl shadow p-5 border-l-8 border-green-500">
        <h3 class="text-gray-500">Ingresos</h3>
        <p class="text-3xl font-bold text-green-600 mt-1">$<span x-text="ingresos.toFixed(2)"></span></p>
      </div>

      <div class="bg-white rounded-xl shadow p-5 border-l-8 border-red-500">
        <h3 class="text-gray-500">Gastos</h3>
        <p class="text-3xl font-bold text-red-600 mt-1">$<span x-text="gastos.toFixed(2)"></span></p>
      </div>

      <div class="bg-white rounded-xl shadow p-5 border-l-8 border-blue-500">
        <h3 class="text-gray-500">Ahorros</h3>
        <p class="text-3xl font-bold text-blue-600 mt-1">$<span x-text="ahorros.toFixed(2)"></span></p>
      </div>

      <div class="bg-white rounded-xl shadow p-5 border-l-8 border-gray-500">
        <h3 class="text-gray-500">Balance</h3>
        <p class="text-3xl font-bold text-gray-700 mt-1">$<span x-text="balance().toFixed(2)"></span></p>
      </div>
    </section>

    <!-- Barra de ahorro -->
    <div class="bg-white p-4 rounded-xl shadow mb-6" x-show="metaAhorro > 0">
      <h2 class="text-lg font-semibold mb-2">Meta: <span x-text="nombreMeta"></span> ($<span x-text="metaAhorro"></span>)</h2>
      <div class="w-full bg-gray-200 rounded-full h-4 overflow-hidden">
        <div class="bg-blue-500 h-4 rounded-full" :style="{ width: progresoMeta + '%' }"></div>
      </div>
      <p class="mt-1 text-sm text-gray-700" x-text="progresoMeta.toFixed(1) + '%' + ' completado'"></p>
    </div>
  </div>

  <!-- Vista Historial -->
  <div x-show="vista === 'historial'" x-transition>
    <div class="bg-white p-4 rounded-xl shadow mb-6">
      <h2 class="text-lg font-semibold mb-3">Historial de Movimientos</h2>
      <ul class="space-y-1 text-sm">
        <template x-for="mov in historial" :key="mov.fecha + mov.tipo + mov.monto">
          <li class="border-b py-1">
            <span class="font-bold" x-text="mov.tipo"></span>: $<span x-text="mov.monto"></span> el <span x-text="mov.fecha"></span>
          </li>
        </template>
      </ul>
    </div>
  </div>

  <!-- Vista Opiniones -->
  <div x-show="vista === 'opiniones'" x-transition>
    <div class="bg-white p-4 rounded-xl shadow mb-6">
      <h2 class="text-lg font-semibold mb-3">Tu Opinión</h2>
      <textarea x-model="opinion" class="w-full p-3 border rounded mb-2" rows="4" placeholder="Escribe tu opinión..."></textarea>
      <button @click="enviarOpinion()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Enviar</button>
    </div>
  </div>

  <script>
    function dashboard() {
      return {
        vista: 'dashboard',
        user: localStorage.getItem('usuario') || 'Usuario',
        ingresos: 0,
        gastos: 0,
        ahorros: 0,
        historial: [],
        nuevoIngreso: '',
        nuevoGasto: '',
        ahorrarIngreso: false,
        mostrarIngreso: false,
        mostrarGasto: false,
        mostrarMeta: false,
        nombreMeta: '',
        metaAhorro: 0,
        opinion: '',

        agregarIngreso() {
          const monto = parseFloat(this.nuevoIngreso);
          if (!isNaN(monto) && monto > 0) {
            if (this.ahorrarIngreso) {
              this.ahorros += monto;
              this.historial.push({ tipo: 'Ahorro', monto: monto.toFixed(2), fecha: new Date().toLocaleString() });
            } else {
              this.ingresos += monto;
              this.historial.push({ tipo: 'Ingreso', monto: monto.toFixed(2), fecha: new Date().toLocaleString() });
            }
            this.nuevoIngreso = '';
            this.ahorrarIngreso = false;
            this.mostrarIngreso = false;
          }
        },

        agregarGasto() {
          const monto = parseFloat(this.nuevoGasto);
          if (!isNaN(monto) && monto > 0) {
            this.gastos += monto;
            this.historial.push({ tipo: 'Gasto', monto: monto.toFixed(2), fecha: new Date().toLocaleString() });
            this.nuevoGasto = '';
            this.mostrarGasto = false;
          }
        },

        balance() {
          return this.ingresos - this.gastos;
        },

        get progresoMeta() {
          if (this.metaAhorro === 0) return 0;
          return Math.min((this.ahorros / this.metaAhorro) * 100, 100);
        },

        enviarOpinion() {
          if (this.opinion.trim() !== '') {
            alert("Gracias por tu opinión: " + this.opinion);
            this.opinion = '';
          }
        }
      }
    }
  </script>
</body>
</html>
